<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:h="http://java.sun.com/jsf/html" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets">

    <h:body> 
    	<ui:composition template="/template/layout.xhtml">
 		<ui:define name="content">
 		<h:form id="frmPedido">
 		
			<p:panelGrid style="margin-top:20px">
				<!-- Titulo de la tabla -->   
				<f:facet name="header">
 					<p:row>  
            			<p:column colspan="2">Pedido</p:column>  
       				</p:row>       				
 				</f:facet>
 				
 				<!-- Separador Datos Generales--> 				
				<p:row>  
        			<p:column colspan="2" styleClass="ui-widget-header">	  
            			Datos Generales del Pedido
        			</p:column>
    			</p:row>
				
				<!-- Ubigeo -->
				<p:row>
					<p:column>
						Departamento	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiDepa" value="#{pedidoManaged.ubiDepaSelect}">
            			<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.listaUbiDepa}" 
	                				   var="ubiDepa"
	                				   itemLabel="#{ubiDepa.udnombre}"                				   
	                		/>  
	                		
	                		<p:ajax update="cboUbiProv"  
                        		listener="#{pedidoManaged.handleDepaChange}" />  
	                		<f:converter converterId="ubigeoDepaConverter" />
            			</p:selectOneMenu>
        			</p:column>
    			</p:row>
    			
    			<p:row>
					<p:column>
						Provincia	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiProv" value="#{pedidoManaged.ubiProvSelect}">
            				<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.listaUbiProv}" 
	                				   var="ubiProv"
	                				   itemLabel="#{ubiProv.upnombre}"                				   
	                		/>  
	                		<p:ajax update="cboUbiDist"  
                        		listener="#{pedidoManaged.handleProvChange}" />  
	                		<f:converter converterId="ubigeoProvConverter" />
            			</p:selectOneMenu>
        			</p:column>
    			</p:row>
    			
    			<p:row>
					<p:column>
						Distrito	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiDist" value="#{pedidoManaged.ubiDistSelect}">
            				<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.listaUbiDist}" 
	                				   var="ubiDist"
	                				   itemLabel="#{ubiDist.udinombre}"                				   
	                		/>
	                		<p:ajax 
	                			update=":frmPedido:tblDetalle:btnAgregarProducto :frmBuscarProducto:tblProductos"
                        		listener="#{pedidoManaged.handleDistChange}" />  
	                		<f:converter converterId="ubigeoDistConverter" />
            			</p:selectOneMenu>
        			</p:column>
    			</p:row>
    			
    			<!-- Dirección -->
    			
    			<p:row>  
        			<p:column>	
        				Dirección Destino:		  
        			</p:column>
        			<p:column>	
        				  <p:inputText id="txtDireccion" value="#{pedidoManaged.direccionDestino}" />
        			</p:column>
       			</p:row>
       			
       			<p:row>  
        			<p:column>	
        				Referencia		  
        			</p:column>
        			<p:column>	
        				  <p:inputText id="txtReferencia" value="#{pedidoManaged.referenciaDirDestino}" />
        			</p:column>
       			</p:row>
    						
				<p:row>  
        			<p:column colspan="2" styleClass="ui-widget-header">	  
            			Detalle del Pedido
        			</p:column>
    			</p:row>
    			
    			<p:row>  
        			<p:column colspan="2" >	  
            			<p:dataTable id="tblDetalle" var="detalle" value="#{pedidoManaged.listaDetallePedido}" 
    					 rowKey="#{detalle.id}" wigdetvar="tableDetalle" >  
						  	<f:facet name="header">  
		            			Detalle del pedido  
		        			</f:facet>  
		  						
			  				 <p:column headerText="Producto">  
			            		#{detalle.productoTienda.productoEmpresa.descripcion}  
			        		 </p:column>  
			  				
			  				 <p:column headerText="Cantidad">	  
			            		<p:spinner id="detCantidad"   
	                    			value="#{detalle.cantidad}" min="0" max="100"/> 
			        		 </p:column>
			        		 
		        			<p:column style="width:4%">  
                				<p:commandButton  icon="ui-icon-search" >  
                			  
            					</p:commandButton>  
        					</p:column>
        			
        					<p:column style="width:4%">  
                				<p:commandButton id="deleteButton" update="tblDetalle" icon="i-icon-circle-close" title="Delete">  
            					</p:commandButton>  
        					</p:column>    
		  				
		  					<f:facet name="footer">  
					           <p:commandButton id="btnAgregarProducto" value="Agregar Producto"  
					            	  onclick="buscarProducto.show()"
					            	  disabled="#{empty pedidoManaged.listaTiendas}"
			             	   />
		  					</f:facet>
		  				</p:dataTable>
		  				
			
		
        			</p:column>
    			</p:row>
    			
    		</p:panelGrid>
			
								  
             	
			
		</h:form>
		
		<!-- Form de busqueda de producto -->		
		  
  	 	<h:form id="frmBuscarProducto">      
  	 	 	<p:confirmDialog global="true" showEffect="fade" hideEffect="explode" id="insertDialog" header="Insertar" widgetVar="buscarProducto" resizable="false">  
        	<h:panelGrid columns="2" cellpadding="5">  
           		
           		 	<p:dataTable id="tblProductos" var="prodTie" value="#{pedidoManaged.listaProductoTienda}" widgetVar="tablaProductos"   
           						 emptyMessage="No se encontró productos." filteredValue="#{pedidoManaged.listaProdTiendaFliltrados}">  
  						
			        	<p:column filterBy="#{prodTie.tienda}"   
			                headerText="Franquicia" 
			                filterOptions="#{pedidoManaged.listaFranquicia}"
			                filterMatchMode="exact">
            				<h:outputText value="#{prodTie.id}" />
				        </p:column>  

  						
  						
  						<p:column headerText="Producto" filterBy="#{prodTie.productoempresa.descripcion}"   
                				  filterMatchMode="contains">  
  							<h:outputText value="#{prodTie.productoempresa.descripcion}" />
  						</p:column>
  						
  						<p:column headerText="Precio Unitario">
  							<h:outputText value="#{prodTie.productoempresa.precioventa}" />  
  						</p:column>
  						
  						
  					
  					</p:dataTable>		   		
            
            </h:panelGrid>
	    	</p:confirmDialog>
		</h:form>  

		
 		</ui:define>
    	</ui:composition> 
    </h:body>
 
</html>

  
