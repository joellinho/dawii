<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:h="http://java.sun.com/jsf/html" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head>



  </h:head>
    <h:body>
     
    
    
    	<ui:composition template="/template/layout.xhtml">
 		<ui:define name="content">
 		<h:outputStylesheet name="css/extra.css" />
 		 		
 		<!-- Datos del Pedido -->
 		 <p:panel header="Pedido">  
 		
 		
		<h:form id="frmPedido">

		<f:facet name="header">
		    <p:row>
			<p:column colspan="2" >	  
          			Pedido
      		</p:column>
    		</p:row>   				
		</f:facet>
 					
 				<p:panelGrid style="margin-top:20px">
			
 								
				<!-- Ubigeo -->
				<p:row>
	   				<p:column colspan="4" styleClass="ui-widget-header">  
	   					Dirección de Entrega
	   				</p:column>	   	
	   				<p:column styleClass="ui-widget-header">  
	   					
	   				</p:column>	   	
					<p:column colspan="2" styleClass="ui-widget-header">  
	   					Comprobante de Pago
	   				</p:column>	   		
	   			</p:row>
			
				<p:row>
					<!-- Ubigeo Departamento -->
					<p:column>
						Departamento	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiDepa" value="#{pedidoManaged.ubigeoManaged.ubiDepaSelect}">
            			<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.ubigeoManaged.listaUbiDepa}"
	                				   var="ubiDepa"
	                				   itemLabel="#{ubiDepa.udNombre}"                				   
	                		/>  
	                		
	                		<p:ajax update="cboUbiProv"  
                        		listener="#{pedidoManaged.ubigeoManaged.handleDepaChange}" />  
	                		<f:converter converterId="ubigeoDepaConverter" />
            			</p:selectOneMenu>
        			</p:column>
        			
        			<p:column>	
        				Dirección Destino:		  
        			</p:column>
        			<p:column>	
        				  <p:inputText id="txtDireccion" value="#{pedidoManaged.direccionDestino}" required="true">
        				  <p:ajax update="msgDireccion" event="keyup" />
        				  </p:inputText>
        				  <p:message for="txtDireccion" id="msgDireccion" display="icon"/>
        			</p:column>
  			        <p:column>
        				
        			</p:column>
       			     
       			     
       			     <p:column>
        				TipoComprobante
        			</p:column>
        			<p:column colspan="3">
        				<p:selectOneMenu id="cboTipoComp" value="#{pedidoManaged.tipocomprobanteSelect}">
            				<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.listaTipoComp}" 
	                				   var="tipoComp"
	                				   itemLabel="#{tipoComp.descripcion}"                				   
	                		/>
	                		<p:ajax update="lblRazonSocial btnGenerarPedido"  
                        		listener="#{pedidoManaged.updateNombreLabelRS}" />  
	                		<f:converter converterId="tipocomprobanteConverter" />
            			</p:selectOneMenu>
        			</p:column>   			
    			</p:row>
    			
    			<p:row>
					<p:column>
						Provincia	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiProv" value="#{pedidoManaged.ubigeoManaged.ubiProvSelect}">
            				<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.ubigeoManaged.listaUbiProv}" 
	                				   var="ubiProv"
	                				   itemLabel="#{ubiProv.upNombre}"                				   
	                		/>  
	                		<p:ajax update="cboUbiDist"  
                        		listener="#{pedidoManaged.ubigeoManaged.handleProvChange}" />  
	                		<f:converter converterId="ubigeoProvConverter" />
            			</p:selectOneMenu>
        			</p:column>
        			<p:column>	
        				Referencia		  
        			</p:column>
        			<p:column>	
        				  <p:inputText id="txtReferencia" value="#{pedidoManaged.referenciaDirDestino}" required="true">
        				  <p:ajax update="msgReferencia" event="keyup" />
        				  </p:inputText>
        				  <p:column>
        				  <p:message for="txtReferencia" id="msgReferencia" display="icon"/>
        				  </p:column>
        			</p:column>
        			
        			<p:column>
        				
        			</p:column>
        			
       				<p:column>
        				<h:outputLabel id="lblRazonSocial" value="#{pedidoManaged.nombreLabelRS}" />  
        			</p:column>
        			<p:column colspan="3">
        				  <p:inputText id="txtRazonSocial" value="#{pedidoManaged.razonSocial}" />
        			</p:column>
        			
        			<p:column>
        				
        			</p:column>  
        			  
	        		<p:column colspan="2" styleClass="ui-widget-header">  
	   					Realizar Pedido
	   				</p:column>	   		
	       			
    			</p:row>
    			
    			<p:row>
					<p:column>
						Distrito	  
					</p:column>  
        			<p:column>	  
            			<p:selectOneMenu id="cboUbiDist" value="#{pedidoManaged.ubigeoManaged.ubiDistSelect}">
            				<f:selectItem itemLabel="Seleccionar" itemValue="" />  
	                		<f:selectItems value="#{pedidoManaged.ubigeoManaged.listaUbiDist}" 
	                				   var="ubiDist"
	                				   itemLabel="#{ubiDist.udiNombre}"                				   
	                		/>
	                		<p:ajax 
	                			update=":frmBuscarProducto:tblProductos"
                        		listener="#{pedidoManaged.ubigeoManaged.handleDistChange}" />  
	                		<f:converter converterId="ubigeoDistConverter" />
            			</p:selectOneMenu>
        			</p:column>
        			
        			<p:column>	
        				   Obtener dirección por defecto
        			</p:column>
        			
        			<p:column>
        				 <p:commandLink id="ajax" update="cboUbiDepa cboUbiProv cboUbiDist txtDireccion" actionListener="#{pedidoManaged.obtenerUbigeoDefault}" style="margin-right:20px;">  
        					<h:outputText value="Dirección" />  
  					  	 </p:commandLink>  
        			</p:column>
        			
        			<p:column>
        				
        			</p:column>
        			
       				<p:column>
        				Documento
        			</p:column>
        			<p:column colspan="3">
        				  <p:inputText id="txtNumeroDoc" value="#{pedidoManaged.numeroDoc}" />
        			</p:column>
        			
        			<p:column>
        				
        			</p:column>  
        			  
	        		<p:column>	
	        				   <p:commandButton id="btnGenerarPedido" value="Enviar Pedido"  
		                    					action="#{pedidoManaged.registrarPedido}" ajax="false"
		                    					disabled="#{empty pedidoManaged.listaDetallePedido || empty pedidoManaged.tipocomprobanteSelect}"
		                    					/>
	        		</p:column>
    			</p:row>
    			
    		
    		
	   						
    		
       		
       			
  			
    			
    			
    		</p:panelGrid>
			</h:form>
			
			
			<h:form id="frmDetallePedido">
			
				<p:dataTable id="tblDetalle" var="detalle" value="#{pedidoManaged.listaDetallePedido}" 
   					 rowKey="#{detalle.id}" wigdetvar="tableDetalle"  
   					  rowStyleClass="ui-widget"
   					 scrollable="true" scrollHeight="120">
  						
  					<f:facet name="header">  
	            			Detalle del pedido  
        			</f:facet>  	
  						
  					 <p:column headerText="CC" styleClass="ui-widget" >  
	            		#{detalle.productotienda.tienda.empresacomercial.nombrecomercial}  
	        		 </p:column>  	
  						
	  				 <p:column headerText="Producto"  styleClass="ui-widget" >    
	            		#{detalle.productotienda.productoempresa.descripcion}  
	        		 </p:column>  
	  				
	  				 <p:column headerText="Cantidad"  styleClass="ui-widget" >  		  				 	  
	            		<p:spinner 
                   			value="#{detalle.cantidad}" min="1" max="99">
                   			
                   		<p:ajax 
                			update=":frmEnviarPedido:datosFinales"
                       		listener="#{pedidoManaged.actualizarCostosTotales}" /> 	
                   			
                   			
                  			</p:spinner> 
	        		 </p:column>
      			
      					<p:column headerText="Eliminar" style="width:4%"  styleClass="ui-widget" >    
              				<p:commandButton id="deleteButton" update=":frmDetallePedido:tblDetalle :frmBuscarProducto:tblProductos :frmEnviarPedido:datosFinales :frmPedido:btnGenerarPedido" 
              					icon="ui-icon-close" title="Delete" action="#{pedidoManaged.removerDetalle}">		                 
	                 
	                 		<f:setPropertyActionListener value="#{detalle}" target="#{pedidoManaged.selectedDetalle}" />
	                   
          					</p:commandButton>  
      					</p:column>    
  					
  					 <f:facet name="footer">  

				            	   
             				 <p:commandButton id="btnBuscarProducto" value="Agregar Producto"
             				  onclick="prdDlg.show()" />  
		        	</f:facet>  
  					
					
  				
					</p:dataTable> 		
			
			</h:form>
			
 			
 			<h:form id="frmBuscarProducto">      
 			<p:dialog id="prodDialog" header="Productos" widgetVar="prdDlg" modal="true" >  
    		  
 			<p:dataTable id="tblProductos" var="prodTie" value="#{pedidoManaged.listaProductoTienda}" widgetVar="tablaProductos"   
           						 emptyMessage="No se encontró productos." filteredValue="#{pedidoManaged.listaProdTiendaFliltrados}"
           						 rowStyleClass="#{prodTie.selected? 'newSelectedRow' : 'ui-widget' }"
	           					 paginator="true" rows="10"  
	                 			 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
				                 rowsPerPageTemplate="5,10,15"								
				                 >  
           						 
			        	<p:column filterBy="#{prodTie.tienda}"   
			                headerText="Franquicia" 
			                filterOptions="#{pedidoManaged.listaFranquicia}"
			                filterMatchMode="exact">
            				<h:outputText value="#{prodTie.productoempresa.empresacomercial.nombrecomercial}" />
				        </p:column>
  						
  						<p:column headerText="Producto" filterBy="#{prodTie.productoempresa.descripcion}"   
                				  filterMatchMode="contains">  
  							<h:outputText value="#{prodTie.productoempresa.descripcion}" />
  						</p:column>
  						
  						<p:column headerText="Precio Unitario">
  							<h:outputText value="#{prodTie.productoempresa.precioventa}" />  
  						</p:column>
  						
  						<p:column style="width:4%">  
			                <p:commandButton id="selectButton" update=":frmDetallePedido:tblDetalle :frmBuscarProducto:tblProductos :frmEnviarPedido:datosFinales :frmPedido:btnGenerarPedido" 
			                icon="ui-icon-arrowreturn-1-n" title="View"
			                 action="#{pedidoManaged.agregarProducto}" disabled="#{prodTie.selected}">		                 
			                 
			                 <f:setPropertyActionListener value="#{prodTie}" target="#{pedidoManaged.productoTiendaSelect}" />
			                 
			                </p:commandButton>    
        				</p:column>   	
        								
  				
			</p:dataTable>	
 				
 			</p:dialog>
 			
 		
 			</h:form>	  
   			 	
    		<h:form id="frmEnviarPedido" >    
    					
 				<p:panelGrid style="margin-top:20px" id="datosFinales">
 				
	 				<p:row>
	 					<p:column>
	 						<h:outputText value="Sub Total"  />		 
	 					</p:column>
	 					<p:column>
	 						<p:inputText value="#{pedidoManaged.subTotal}"  readonly = "true"/>  
	 					</p:column>
 					</p:row>	
					
 					<p:row>
	 					<p:column>
	 						<h:outputText value="I.G.V."  /> 
	 					</p:column>
	 					<p:column>
	 						<p:inputText value="#{pedidoManaged.impuestoIgv}"  readonly = "true"/>  
	 					</p:column>
 					</p:row>
 					
 					<p:row>
	 					<p:column>
	 						<h:outputText value="Total:"  />	
	 					</p:column>
	 					<p:column>
	 						<p:inputText value="#{pedidoManaged.total}"  readonly = "true"/>  
	 					</p:column>
 					</p:row>	 						
 					
	 				<!-- Detalle Pedido-->
           			
	       			
	 			
 				</p:panelGrid>	
        		
								  
          	</h:form>
			
		 </p:panel>  
	

 		</ui:define>
    	</ui:composition> 
    </h:body>
 
</html>
